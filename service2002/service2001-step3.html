<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>វិញ្ញាបនបត្របញ្ជាក់បញ្ជីកសិកម្ម - ជំហាន 3</title>

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hanuman:wght@100;300;400;700;900&display=swap" rel="stylesheet">

    <!-- Shared CSS -->
    <link rel="stylesheet" href="service2001.css">

    <style>
        /* ========= Document list styles ========= */

        .doc-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .doc-item {
            display: flex;
            align-items: stretch;
            justify-content: space-between;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
        }

        .doc-main {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .doc-title-row {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }

        .doc-title {
            font-weight: 600;
            color: #111827;
        }

        .doc-required {
            color: #dc2626;
            font-weight: 700;
        }

        .doc-meta-row {
            font-size: 12px;
            color: #6b7280;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .doc-status-empty {
            color: #9ca3af;
            font-style: italic;
        }

        .doc-status-hasfile {
            color: #065f46;
            font-weight: 600;
        }

        .doc-file-row {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .doc-file-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 999px;
            background: #ecfdf3;
            border: 1px solid #bbf7d0;
            font-size: 12px;
            color: #14532d;
        }

        .doc-file-pill svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
        }

        .doc-file-name-btn {
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            cursor: pointer;
            font-family: 'Hanuman', serif;
            font-size: 12px;
            color: #14532d;
            text-decoration: underline;
        }

        .doc-file-delete-btn {
            background: none;
            border: none;
            padding: 0;
            margin-left: 4px;
            cursor: pointer;
        }

        .doc-file-delete-btn svg {
            width: 14px;
            height: 14px;
            stroke: #b91c1c;
        }

        .doc-actions {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            flex-shrink: 0;
        }

        .btn-attach {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid #d1d5db;
            background: #ffffff;
            cursor: pointer;
            font-family: 'Hanuman', serif;
            font-size: 13px;
        }

        .btn-attach:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .btn-attach svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
        }

        .doc-hidden-input {
            display: none;
        }

        /* Declaration section */

        .declaration-row {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            font-size: 14px;
            line-height: 1.6;
            color: #111827;
        }

        .declaration-row input[type="checkbox"] {
            margin-top: 3px;
            width: 16px;
            height: 16px;
            accent-color: #008000;
            flex-shrink: 0;
        }

        .contract-link {
            color: #0b57d0;
            text-decoration: underline;
            font-weight: 600;
        }

        .contract-link:hover {
            text-decoration: none;
        }

        .required-star {
            color: #dc2626;
            margin-left: 4px;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            .doc-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .doc-actions {
                align-self: stretch;
                justify-content: flex-start;
            }
        }
        /* Stepper icon mode */
        .step-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        .step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #16a34a;
            color: #ffffff;
        }
        .step-item.active .step-number {
            background: #16a34a;
            color: #ffffff;
        }
        .step-item.completed .step-number {
            background: #16a34a;
            color: #ffffff;
        }
        .step-number svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
        }
        .step-texts {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .step-next-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            opacity: 0.7;
        }
        .step-next-icon svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
        }
        .step-item:last-child .step-next-icon {
            opacity: 0;
        }
    </style>
</head>
<body>
<div class="container">

    <!-- Page header -->
    <div class="page-header-soft">
        <div class="page-title">
            ២. វិញ្ញាបនបត្របញ្ជាក់ការចុះបញ្ជីឃ្លាំងសន្និធិជីកសិកម្ម
        </div>
        <div class="page-home">
            <a href="../home.html" class="home-link">
                <img class="home-icon" src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="home">
                ទំព័រដើម
            </a>
        </div>
    </div>

    <!-- Stepper -->
    <div class="stepper">

        <a href="service2001-step1.html" class="step-item completed">
            <div class="step-number">
                <!-- user icon -->
                <svg viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="8" r="3.5" stroke-width="1.8"/>
                    <path d="M5 19c1.5-3 3.9-4.5 7-4.5s5.5 1.5 7 4.5" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="step-texts">
                <span class="step-label-main">ព័ត៌មានអ្នកឈរឈ្មោះ</span>
            </div>
            <div class="step-next-icon">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6l6 6-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </a>

        <a href="service2001-step2.html" class="step-item completed">
            <div class="step-number">
                <!-- document icon -->
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M7 3h7l5 5v13H7z" stroke-width="1.8" stroke-linejoin="round"/>
                    <path d="M14 3v5h5" stroke-width="1.8" stroke-linejoin="round"/>
                    <path d="M9 13h6M9 16h4" stroke-width="1.6" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="step-texts">
                <span class="step-label-main">ព័ត៌មានពាក្យស្នើសុំ</span>
            </div>
            <div class="step-next-icon">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6l6 6-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </a>

        <a href="service2001-step3.html" class="step-item active">
            <div class="step-number">
                <!-- paperclip icon -->
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M8.5 8.75l5.25-5.25a3.75 3.75 0 1 1 5.3 5.3l-7.07 7.07a4.25 4.25 0 1 1-6.01-6.01L12 4" 
                          stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="step-texts">
                <span class="step-label-main">ឯកសារភ្ជាប់</span>
            </div>
            <div class="step-next-icon">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6l6 6-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </a>

        <a href="service2001-step4.html" class="step-item">
            <div class="step-number">
                <!-- eye (review) icon -->
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12Z" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="12" cy="12" r="3" stroke-width="1.8"/>
                </svg>
            </div>
            <div class="step-texts">
                <span class="step-label-main">ពិនិត្យឡើងវិញ</span>
            </div>
            <div class="step-next-icon">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6l6 6-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </a>

        <a href="service2001-step5.html" class="step-item">
            <div class="step-number">
                <!-- credit card icon -->
                <svg viewBox="0 0 24 24" fill="none">
                    <rect x="3" y="5" width="18" height="14" rx="2" stroke-width="1.8"/>
                    <path d="M3 9h18" stroke-width="1.8"/>
                    <path d="M7 14h4" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="step-texts">
                <span class="step-label-main">បង់ប្រាក់</span>
            </div>
            <div class="step-next-icon">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M9 6l6 6-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
        </a>
</div>

    <!-- SECTION 1: Attachments -->
    <div class="section">
        <div class="section-header" onclick="toggleSection(this)">
            ១. ឯកសារភ្ជាប់
        </div>
        <div class="section-content">
            <div class="form-container">

                <div class="doc-list" id="docListContainer">
                    <!-- Filled by JS -->
                </div>

            </div>
        </div>
    </div>

    <!-- SECTION 2: Declaration -->
    <div class="section">
        <div class="section-header" onclick="toggleSection(this)">
            ២. សេចក្តីប្រកាសដោយសុទ្ធចិត្ត
        </div>
        <div class="section-content">
            <div class="form-container">
                <label class="declaration-row">
                    <input type="checkbox" id="honestDeclaration">
                    <span>
                        ខ្ញុំសូមប្រកាសថា ខ្ញុំពុំមានជាប់ទោសពៃរ៍ក្នុងកិច្ចការពាណិជ្ជកម្ម រដ្ឋប្បវេណី ឬព្រហ្មទណ្ឌ នៃព្រះរាជាណាចក្រកម្ពុជា
                        និងក្នុងករណីខ្ញុំជាមន្រ្តីរាជការក្នុងក្រសួង ឬស្ថាប័នរដ្ឋណាមួយនោះ សូមសន្យាថានឹងមិនយកម៉ោងរដ្ឋបាលទៅប្រកបមុខរបរនេះឡើយ។ 
                        ខ្ញុំសូមសន្យាថារាល់ព័ត៌មាន និងឯកសារដែលផ្តល់ជូន ពិតជាត្រឹមត្រូវ និងមិនមានការក្លែងបន្លំ។ 
                        ខ្ញុំបានអាន និងឯកភាពគ្រប់ចំណុចទាំងអស់នៃកិច្ចសន្យា
                        <a href="#" class="contract-link" target="_blank">ពិនិត្យកិច្ចសន្យា</a>
                        <span class="required-star">*</span>
                    </span>
                </label>
            </div>
        </div>
    </div>

    <!-- Bottom navigation -->
    <div class="step-nav">
        <button class="btn btn-outline-green" type="button">
            <span class="btn-icon">
                <svg viewBox="0 0 24 24">
                    <path d="M5 3h14v18H5z" stroke="currentColor" stroke-width="1.6" fill="none"/>
                    <path d="M5 9h14" stroke="currentColor" stroke-width="1.6"/>
                    <path d="M9 3v6" stroke="currentColor" stroke-width="1.6"/>
                    <rect x="9" y="13" width="6" height="5" stroke="currentColor" stroke-width="1.6" fill="none"/>
                </svg>
            </span>
            រក្សាទុក & ចាកចេញ
        </button>

        <div class="step-right-group">
            <button class="btn btn-outline-green" type="button" onclick="window.location.href='service2001-step2.html'">
                <span class="btn-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </span>
                ត្រឡប់ក្រោយ
            </button>

            <button class="btn btn-primary" type="button" onclick="window.location.href='service2001-step4.html'">
                បន្ទាប់
                <span class="btn-icon-right">
                    <svg viewBox="0 0 24 24">
                        <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </span>
            </button>
        </div>
    </div>

</div>

<script>
    function toggleSection(header) {
        const content = header.nextElementSibling;
        header.classList.toggle('collapsed');
        content.classList.toggle('collapsed');
    }

    // ====== Document list data ======
    const docItemsData = [
        { id: 'doc1',  title: 'វិញ្ញាបនបត្រចុះបញ្ជីពាណិជ្ជកម្ម ប័ណ្ណប៉ាតង់ ឬ ប័ណ្ណបង់ពន្ធលើផលរបរ (ITR) នៃចុងឆ្នាំក្រោយ ឬឯកសារបញ្ជាក់ការចុះបញ្ជីនីតិបុគ្គលឯកជនផ្សេងទៀត', required: true },
        { id: 'doc2',  title: 'លិខិតអនុញ្ញាតដែលមានសុពលភាព ចេញដោយក្រសួងកសិកម្ម រុក្ខាប្រមាញ់ និងនេសាទ', required: true },
        { id: 'doc3',  title: 'របាយការណ៍ត្រួតពិនិត្យ និងវាយតម្លៃលើទីតាំងឃ្លាំងសន្និធិដោយមន្ត្រីអធិការកិច្ចជីកសិកម្ម នៅពេលមុនធ្វើការចុះបញ្ជី', required: true },
        { id: 'doc4',  title: 'វិញ្ញាបនបត្របញ្ជាក់បញ្ជិកាជីកសិកម្មតាមយថាប្រភេទនីមួយៗ ដែលត្រូវធ្វើសន្និធិនៅក្នុងឃ្លាំង', required: true },
        { id: 'doc5',  title: 'របាយការណ៍អំពីសមត្ថភាពធ្វើប្រតិបត្តិការសន្និធិជីកសិកម្មរបស់ក្រុមហ៊ុនក្នុងឆ្នាំចុងក្រោយមុនពេលស្នើសុំ', required: true },
        { id: 'doc6',  title: 'វិក្កយបត្រកម្រៃសេវាកម្មសម្រាប់ការចុះបញ្ជីឃ្លាំងសន្និធិជីកសិកម្ម', required: true },
        { id: 'doc7',  title: 'ឯកសារយោង', required: false },
    ];

    function buildDocList() {
        const container = document.getElementById('docListContainer');
        if (!container) return;

        docItemsData.forEach(item => {
            const wrapper = document.createElement('div');
            wrapper.className = 'doc-item';
            wrapper.id = `${item.id}-wrapper`;

            wrapper.innerHTML = `
                <div class="doc-main">
                    <div class="doc-title-row">
                        <div class="doc-title">${item.title}</div>
                        ${item.required ? '<div class="doc-required">*</div>' : ''}
                    </div>
                    <div class="doc-meta-row" id="${item.id}-meta">
                        <span class="doc-status doc-status-empty">ឯកសារមិនទាន់មាន</span>
                    </div>
                </div>
                <div class="doc-actions">
                    <button 
                        type="button" 
                        class="btn-attach" 
                        id="${item.id}-btn"
                        onclick="triggerUpload('${item.id}')">
                        <svg viewBox="0 0 24 24">
                            <path d="M16.5 6.75L9.75 13.5a2.25 2.25 0 1 1-3.18-3.18L12 4.88a3.75 3.75 0 1 1 5.3 5.3l-7.07 7.07" 
                                  fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>បញ្ចូល</span>
                    </button>
                    <input 
                        type="file" 
                        id="${item.id}-input"
                        class="doc-hidden-input"
                        accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
                        onchange="handleFileChange('${item.id}')"
                    />
                </div>
            `;

            container.appendChild(wrapper);
        });
    }

    function triggerUpload(docId) {
        const input = document.getElementById(`${docId}-input`);
        if (input) {
            input.click();
        }
    }

    function handleFileChange(docId) {
        const input = document.getElementById(`${docId}-input`);
        const meta  = document.getElementById(`${docId}-meta`);
        const btn   = document.getElementById(`${docId}-btn`);

        if (!input || !meta || !btn) return;

        const file = input.files[0];
        meta.innerHTML = '';

        if (!file) {
            // No file → show empty status, button label = "បញ្ចូល"
            meta.innerHTML = `<span class="doc-status doc-status-empty">ឯកសារមិនទាន់មាន</span>`;
            btn.innerHTML = `
                <svg viewBox="0 0 24 24">
                    <path d="M16.5 6.75L9.75 13.5a2.25 2.25 0 1 1-3.18-3.18L12 4.88a3.75 3.75 0 1 1 5.3 5.3l-7.07 7.07" 
                          fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>បញ្ចូល</span>
            `;
            return;
        }

        // Has file → show file info row
        const fileRow = document.createElement('div');
        fileRow.className = 'doc-file-row';

        fileRow.innerHTML = `
            <span class="doc-status doc-status-hasfile">ឯកសារបានបញ្ចូល</span>
            <span class="doc-file-pill">
                <svg viewBox="0 0 24 24">
                    <path d="M7 3h7l5 5v13H7z" fill="none" stroke="currentColor" stroke-width="1.4"/>
                    <path d="M14 3v5h5" fill="none" stroke="currentColor" stroke-width="1.4"/>
                </svg>
                <button 
                    type="button" 
                    class="doc-file-name-btn"
                    onclick="viewFile('${docId}')">
                    ${file.name}
                </button>
                <button 
                    type="button" 
                    class="doc-file-delete-btn"
                    onclick="clearFile('${docId}')"
                    title="លុបឯកសារ">
                    <svg viewBox="0 0 24 24">
                        <path d="M6 7h12" fill="none" stroke="currentColor" stroke-width="1.6"/>
                        <path d="M10 11v6" fill="none" stroke="currentColor" stroke-width="1.6"/>
                        <path d="M14 11v6" fill="none" stroke="currentColor" stroke-width="1.6"/>
                        <path d="M9 7l1-2h4l1 2" fill="none" stroke="currentColor" stroke-width="1.6"/>
                        <path d="M7 7v11a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V7" fill="none" stroke="currentColor" stroke-width="1.6"/>
                    </svg>
                </button>
            </span>
        `;

        meta.appendChild(fileRow);

        // Update button to "ផ្លាស់ប្តូរ"
        btn.innerHTML = `
            <svg viewBox="0 0 24 24">
                <path d="M16.5 6.75L9.75 13.5a2.25 2.25 0 1 1-3.18-3.18L12 4.88a3.75 3.75 0 1 1 5.3 5.3l-7.07 7.07" 
                      fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>ផ្លាស់ប្តូរ</span>
        `;
    }

    function clearFile(docId) {
        const input = document.getElementById(`${docId}-input`);
        const meta  = document.getElementById(`${docId}-meta`);
        const btn   = document.getElementById(`${docId}-btn`);

        if (!input || !meta || !btn) return;

        input.value = '';
        meta.innerHTML = `<span class="doc-status doc-status-empty">ឯកសារមិនទាន់មាន</span>`;
        btn.innerHTML = `
            <svg viewBox="0 0 24 24">
                <path d="M16.5 6.75L9.75 13.5a2.25 2.25 0 1 1-3.18-3.18L12 4.88a3.75 3.75 0 1 1 5.3 5.3l-7.07 7.07" 
                      fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>បញ្ចូល</span>
        `;
    }

    function viewFile(docId) {
        const input = document.getElementById(`${docId}-input`);
        if (!input || !input.files || !input.files[0]) {
            alert('មិនទាន់មានឯកសារដើម្បីបង្ហាញទេ។');
            return;
        }
        const file = input.files[0];
        const url  = URL.createObjectURL(file);
        window.open(url, '_blank');
    }

    window.addEventListener('DOMContentLoaded', () => {
        buildDocList();
    });
</script>

</body>
</html>
