<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ទម្រង់ចុះឈ្មោះ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hanuman:wght@100;300;400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hanuman', serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #ffffff 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ===== Stepper ===== */
        .stepper {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 20px;
        }

        .step-item {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            border-radius: 999px;
            background: white;
            color: #2f5233;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .step-item:hover {
            background: #d8ebde;
        }

        .step-number {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            border: 2px solid #9abf9f;
        }

        .step-label-main {
            font-weight: 700;
            font-size: 14px;
        }

        .step-label-sub {
            font-size: 12px;
            opacity: 0.8;
        }

        .step-texts {
            display: flex;
            flex-direction: column;
        }

        .step-item.active {
            background: #008000;
            color: #fff;
        }

        .step-item.active .step-number {
            border-color: #fff;
            background: #fff;
            color: #008000;
        }

        .step-item.completed {
            background: #f1eded;
            color: #080707;
        }

        .step-item.completed .step-number {
            border-color: #fff;
            background: #fff;
            color: #2f5233;
        }

        @media (max-width: 768px) {
            .step-label-sub {
                display: none;
            }
            .stepper {
                flex-direction: column;
            }
        }

        /* ===== Sections (cards) ===== */
        .section {
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: white;
        }

        .section-header {
            background: #008000;
            color: white;
            padding: 18px 24px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 18px;
            font-weight: 700;
            transition: background 0.3s ease;
        }

        .section-header:hover {
            background: #006600;
        }

        .section-header::after {
            content: '▼';
            font-size: 14px;
            transition: transform 0.3s ease;
        }

        .section-header.collapsed::after {
            transform: rotate(-90deg);
        }

        .section-content {
            background: white;
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.4s ease;
        }

        .section-content.collapsed {
            max-height: 0;
            padding: 0;
        }

        .form-container {
            padding: 30px;
        }

        /* ===== applicant type row (radios left, checkbox right) ===== */
        .applicant-type-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-pill {
            position: relative;
        }

        .radio-pill input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .radio-pill label {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 400;
            background: white;
            position: relative;
        }

        .radio-pill label::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #bbb;
            border-radius: 50%;
            background: white;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .radio-pill input[type="radio"]:checked + label {
            background: white;
            border-color: #008000;
            color: #008000;
            font-weight: 700;
        }

        .radio-pill input[type="radio"]:checked + label::before {
            border-color: #008000;
            background: white;
            box-shadow: inset 0 0 0 5px #008000;
        }

        .radio-pill label:hover {
            border-color: #008000;
        }

        /* checkbox pill on the right */
        .self-applicant-wrapper {
            display: flex;
            align-items: center;
        }

        .checkbox-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            border: 1.5px solid #e0e0e0;
            background: #fafafa;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .checkbox-pill input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #008000;
        }

        .checkbox-pill:hover {
            border-color: #008000;
            background: #f0fff4;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 10fr 2fr;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-row {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .form-row-3 {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 400;
            color: #333;
            font-size: 15px;
        }

        .form-group label .required {
            color: red;
            margin-left: 3px;
        }

        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group select {
            padding: 12px 16px;
            border: 1.5px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Hanuman', serif;
            font-size: 15px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="date"]:focus,
        .form-group select:focus {
            outline: none;
            border-color: #008000;
            box-shadow: 0 0 0 3px rgba(0, 128, 0, 0.1);
        }

        .form-group input[type="file"] {
            display: none;
        }

        .file-upload-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .file-upload-preview {
            width: 120px;
            height: 140px;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #f9f9f9;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-preview:hover {
            border-color: #008000;
            background: #f0f8f0;
        }

        .file-upload-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-upload-preview svg {
            width: 70px;
            height: 70px;
            color: #ccc;
        }

        .file-upload-btn {
            background: #008000;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Hanuman', serif;
            font-size: 13px;
            transition: background 0.3s ease;
        }

        .file-upload-btn:hover {
            background: #006600;
        }

        .hidden {
            display: none;
        }

        /* Transfer upload row */
        .transfer-upload-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            flex-wrap: wrap;
        }

        .transfer-label-text {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
            color: #333;
        }

        .transfer-label-text .required {
            color: red;
            margin-left: 3px;
        }

        .transfer-label-text a {
            color: #008000;
            text-decoration: underline;
            font-size: 14px;
        }

        .transfer-file-input {
            display: none;
        }

        .transfer-upload-btn {
            background: #008000;
            color: white;
            border: none;
            padding: 8px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Hanuman', serif;
            font-size: 14px;
            transition: background 0.3s ease;
            white-space: nowrap;
        }

        .transfer-upload-btn:hover {
            background: #006600;
        }

        /* Step contents */
        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        /* Step navigation buttons (bottom) */
        .step-nav {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }
        .step-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 18px;
            border-radius: 30px;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            transition: box-shadow 0.2s ease, transform 0.15s ease;
        }

        .step-item:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .step-number {
            width: 34px;
            height: 34px;
            background: #198754;          /* Green */
            color: #ffffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .step-texts {
            display: flex;
            flex-direction: column;
        }

        .step-label-main {
            font-weight: 700;
            font-size: 1rem;
        }

        .step-label-sub {
            font-size: 0.85rem;
            color: #6b7280; /* gray */
        }

        .btn {
            padding: 8px 18px;
            border-radius: 999px;
            border: none;
            font-family: 'Hanuman', serif;
            font-size: 14px;
            cursor: pointer;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn-primary {
            background: #008000;
            color: #fff;
        }

        .btn-primary:hover {
            background: #006600;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                font-size: 16px;
                padding: 15px 20px;
            }
            
            .form-container {
                padding: 20px;
            }

            .applicant-type-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .self-applicant-wrapper {
                align-self: flex-start;
            }

            .checkbox-list {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 35px;
        }

        #repIndividualForm,
        #repCompanyForm {
            padding-top: 16px;
            margin-top: 10px;
        }

        .btn-tertiary {
            background: #ffffff;
            color: #333;
            border: 1.5px solid #dcdcdc;
        }

        .btn-tertiary:hover {
            background: #f5f5f5;
            border-color: #c6c6c6;
        }

        .step-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
        }

        .step-right-group {
            display: flex;
            gap: 10px;
        }

        /* Green outline button */
        .btn-outline-green {
            background: #ffffff;
            color: #008000;
            border: 1.8px solid #008000;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        .btn-outline-green:hover {
            background: #f3fff3;
            color: #006600;
            border-color: #006600;
        }

        .btn-icon svg,
        .btn-icon-right svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
        }

        /* Primary green button */
        .btn-primary {
            background: #008000;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        .btn-primary:hover {
            background: #006600;
        }

        .page-header-soft {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #dcffe6;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .page-title {
            color: #044c29;
        }

        .page-home {
            display: flex;
            align-items: center;
        }

        .home-link {
            display: flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            font-size: 0.95rem;
            color: #0b57d0;
            font-weight: 600;
        }

        .home-link:hover {
            text-decoration: underline;
        }

        .home-icon {
            width: 20px;
            height: 20px;
        }

        /* ==== NEW: Step 2 Section 1 & 2 styles ==== */
        .checkbox-list {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 14px;
            margin-top: 18px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            border-radius: 8px;
            border: 1.5px solid #e0e0e0;
            background: #fafafa;
            cursor: pointer;
            font-size: 14px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #008000;
        }

        #otherPurposeText {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1.5px solid #e0e0e0;
            width: 60%;
            display: none;
        }

        .table-wrapper {
            width: 100%;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 18px;
        }

        table th {
            background: #e8fff0;
            padding: 10px;
            border: 1px solid #dcdcdc;
            text-align: center;
            font-size: 14px;
            color: #055c32;
        }

        table td {
            padding: 8px;
            border: 1px solid #e5e5e5;
            text-align: center;
            font-size: 14px;
        }

        table input[type="text"] {
            width: 100%;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1.2px solid #e0e0e0;
            font-family: 'Hanuman', serif;
            font-size: 14px;
        }

        .table-actions {
            margin-top: 12px;
            display: flex;
            justify-content: flex-end;
        }
    </style>
</head>
<body>

    <div class="container">

        <div class="page-header-soft">
            <div class="page-title">
                ១. វិញ្ញាបនបត្របញ្ជាក់បញ្ជីកសិកម្ម
            </div>

            <div class="page-home">
                <a href="home.html" class="home-link">
                    <img class="home-icon" src="https://cdn-icons-png.flaticon.com/512/25/25694.png" alt="home">
                    ទំព័រដើម
                </a>
            </div>
        </div>

        <!-- Stepper -->
        <div class="stepper">
            <div class="step-item active" data-step="1" onclick="goToStep(1)">
                <div class="step-number">1</div>
                <div class="step-texts">
                    <span class="step-label-main">ព័ត៌មានអ្នកឈរឈ្មោះអាជ្ញាបណ្ណ</span>
                </div>
            </div>
            <div class="step-item" data-step="2" onclick="goToStep(2)">
                <div class="step-number">2</div>
                <div class="step-texts">
                    <span class="step-label-main">ព័ត៌មានពាក្យស្នើសុំ</span>
                </div>
            </div>
            <div class="step-item" data-step="3" onclick="goToStep(3)">
                <div class="step-number">3</div>
                <div class="step-texts">
                    <span class="step-label-main">ឯកសារភ្ជាប់</span>
                </div>
            </div>
            <div class="step-item" data-step="4" onclick="goToStep(4)">
                <div class="step-number">4</div>
                <div class="step-texts">
                    <span class="step-label-main">ពិនិត្យឡើងវិញ</span>
                </div>
            </div>
            <div class="step-item" data-step="5" onclick="goToStep(5)">
                <div class="step-number">5</div>
                <div class="step-texts">
                    <span class="step-label-main">បង់ប្រាក់</span>
                </div>
            </div>
        </div>

        <!-- STEP 1 CONTENT: Section 1 + Section 2 -->
        <div class="step-content active" id="step-1">
            <!-- Section 1 -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    ១. ព័ត៌មានអ្នកឈរឈ្មោះអាជ្ញាបណ្ណ
                </div>
                <div class="section-content">
                    <div class="form-container">
                        <!-- Applicant type row: radios left, checkbox right -->
                        <div class="applicant-type-row">
                            <div class="radio-group">
                                <div class="radio-pill">
                                    <input type="radio" id="individual" name="applicant_type" value="individual" checked onchange="toggleFormType()">
                                    <label for="individual">រូបវន្តបុគ្គល</label>
                                </div>
                                <div class="radio-pill">
                                    <input type="radio" id="company" name="applicant_type" value="company" onchange="toggleFormType()">
                                    <label for="company">នីតិបុគ្គល</label>
                                </div>
                            </div>

                            <!-- Checkbox on the right (only for individual) -->
                            <div class="self-applicant-wrapper" id="selfApplicantWrapper">
                                <label class="checkbox-pill">
                                    <input
                                        type="checkbox"
                                        id="selfApplicant"
                                        onchange="handleSelfApplicantToggle()"
                                    >
                                    <span>បញ្ចូលខ្ញុំជាអ្នកឈរអាជ្ញាបណ្ណ</span>
                                </label>
                            </div>
                        </div>

                        <!-- Company Form -->
                        <div id="companyForm" class="form-grid hidden">
                            <div class="form-group full-width">
                                <label>តើការចុះបញ្ជីអាជីវកម្មរបស់អ្នក បានធ្វើឡើងតាមប្រព័ន្ធ CamDX ឬទេ?</label>
                                <div class="radio-group" style="margin-top: 10px; margin-bottom: 0;">
                                    <div class="radio-pill">
                                        <input type="radio" id="camdx_yes" name="camdx" value="yes" checked onchange="toggleCamdxCompany()">
                                        <label for="camdx_yes">បាទ/ចាស</label>
                                    </div>
                                    <div class="radio-pill">
                                        <input type="radio" id="camdx_no" name="camdx" value="no" onchange="toggleCamdxCompany()">
                                        <label for="camdx_no">ទេ</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="camdxCompanyField" class="form-group full-width">
                                <label>ក្រុមហ៊ុន</label>
                                <select>
                                    <option value="">ជ្រើសរើស</option>
                                    <option value="company1">ក្រុមហ៊ុន ABC</option>
                                    <option value="company2">ក្រុមហ៊ុន XYZ</option>
                                    <option value="company3">ក្រុមហ៊ុន 123</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>លេខចុះបញ្ជីអាជីវកម្ម <span class="required">*</span></label>
                                    <input type="text">
                                </div>
                                <div class="form-group">
                                    <label>លេខអាករលើតម្លៃបន្ថែម(អតប) <span class="required">*</span></label>
                                    <input type="text">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>នាមករណ៍ក្រុមហ៊ុន (ខ្មែរ) <span class="required">*</span></label>
                                    <input type="text">
                                </div>
                                <div class="form-group">
                                    <label>នាមករណ៍ក្រុមហ៊ុន (ឡាតាំង) <span class="required">*</span></label>
                                    <input type="text">
                                </div>
                            </div>
                            
                            <div style="grid-column: 1 / -1; margin-top: 20px;">
                                <h3 style="color: #008000; margin-bottom: 15px; font-size: 16px;">អាសយដ្ឋានបច្ចុប្បន្ន</h3>
                            </div>
                            
                            <div style="grid-column: 1 / -1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                                <div class="form-group">
                                    <label>ខេត្ត/រាជធានី <span class="required">*</span></label>
                                    <select>
                                        <option value="">ជ្រើសរើស</option>
                                        <option value="pp">ភ្នំពេញ</option>
                                        <option value="sr">សៀមរាប</option>
                                        <option value="bb">បាត់ដំបង</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ស្រុក/ខណ្ឌ <span class="required">*</span></label>
                                    <select>
                                        <option value="">ជ្រើសរើស</option>
                                        <option value="dk">ដូនពេញ</option>
                                        <option value="cm">ចំការមន</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ឃុំ/សង្កាត់ <span class="required">*</span></label>
                                    <select>
                                        <option value="">ជ្រើសរើស</option>
                                        <option value="k1">ឃុំ១</option>
                                        <option value="k2">ឃុំ២</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="grid-column: 1 / -1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                                <div class="form-group">
                                    <label>ភូមិ <span class="required">*</span></label>
                                    <select>
                                        <option value="">ជ្រើសរើស</option>
                                        <option value="v1">ភូមិ១</option>
                                        <option value="v2">ភូមិ២</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ផ្លូវ</label>
                                    <input type="text">
                                </div>
                                <div class="form-group">
                                    <label>ផ្ទះលេខ/អាគារ</label>
                                    <input type="text">
                                </div>
                            </div>
                            
                            <div style="grid-column: 1 / -1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                                <div class="form-group">
                                    <label>លេខទូរសព្ទ <span class="required">*</span></label>
                                    <input type="text" placeholder="012 345 678">
                                </div>
                                <div class="form-group">
                                    <label>ទូរស័ព្ទលើតុ</label>
                                    <input type="text" placeholder="023 123 456">
                                </div>
                                <div class="form-group">
                                    <label>អ៊ីម៉ែល <span class="required">*</span></label>
                                    <input type="text" placeholder="example@email.com">
                                </div>
                            </div>
                        </div>

                        <!-- Individual Form -->
                        <div id="individualForm" class="form-grid">
                            <div style="grid-column: 1 / -1;">
                                <div style="display: grid; grid-template-columns: 85fr 15fr; gap: 20px;">
                                    <!-- Left Block: Names -->
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                                        <div class="form-group">
                                            <label>គោត្តនាម (ខ្មែរ) <span class="required">*</span></label>
                                            <input type="text">
                                        </div>
                                        <div class="form-group">
                                            <label>នាម (ខ្មែរ) <span class="required">*</span></label>
                                            <input type="text">
                                        </div>
                                        <div class="form-group">
                                            <label>គោត្តនាម (ឡាតាំង) <span class="required">*</span></label>
                                            <input type="text">
                                        </div>
                                        <div class="form-group">
                                            <label>នាម (ឡាតាំង) <span class="required">*</span></label>
                                            <input type="text">
                                        </div>
                                    </div>
                                    
                                    <!-- Right Block: Photo -->
                                    <div style="display: flex; justify-content: center; align-items: center;">
                                        <div class="form-group" style="width: 100%;">
                                            <div class="file-upload-wrapper">
                                                <div class="file-upload-preview" onclick="document.getElementById('photoUpload').click()">
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                        <circle cx="12" cy="7" r="4"></circle>
                                                    </svg>
                                                </div>
                                                <input type="file" id="photoUpload" accept="image/*" onchange="previewPhoto(event)">
                                                <button type="button" class="file-upload-btn" onclick="document.getElementById('photoUpload').click()">ជ្រើរើសរូបថតបច្ចុប្បន្ន</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                                    <div class="form-group">
                                        <label>ថ្ងៃ/ខែ/ឆ្នាំកំណើត <span class="required">*</span></label>
                                        <input type="date">
                                    </div>
                                    <div class="form-group">
                                        <label>សញ្ជាតិ <span class="required">*</span></label>
                                        <select>
                                            <option value="">ជ្រើសរើស</option>
                                            <option value="khmer">ខ្មែរ</option>
                                            <option value="thai">ថៃ</option>
                                            <option value="vietnam">វៀតណាម</option>
                                            <option value="lao">ឡាវ</option>
                                            <option value="other">ផ្សេងៗ</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>ភេទ <span class="required">*</span></label>
                                        <select>
                                            <option value="">ជ្រើសរើស</option>
                                            <option value="male">ប្រុស</option>
                                            <option value="female">ស្រី</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px;">
                                    <div class="form-group">
                                        <label>លេខអត្តសញ្ញាណប័ណ្ណ <span class="required">*</span></label>
                                        <input type="text">
                                    </div>
                                    <div class="form-group">
                                        <label>ថ្ងៃ/ខែ/ឆ្នាំផ្តល់ <span class="required">*</span></label>
                                        <input type="date">
                                    </div>
                                    <div class="form-group">
                                        <label>ថ្ងៃ/ខែ/ឆ្នាំផុតកំណត់ <span class="required">*</span></label>
                                        <input type="date">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group full-width" style="margin-top: 20px;">
                                <h3 style="color: #008000; margin-bottom: 15px; font-size: 16px;">អាសយដ្ឋានបច្ចុប្បន្ន</h3>
                            </div>
                            
                            <div class="form-row-3">
                                <div class="form-group">
                                    <label>ខេត្ត/រាជធានី <span class="required">*</span></label>
                                    <select>
                                        <option value="">ជ្រើសរើស</option>
                                        <option value="pp">ភ្នំពេញ</option>
                                        <option value="sr">សៀមរាប</option>
                                        <option value="bb">បាត់ដំបង</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ស្រុក/ខណ្ឌ <span class="required">*</span></label>
                                    <select>
                                        <option value="">ជ្រើសរើស</option>
                                        <option value="dk">ដូនពេញ</option>
                                        <option value="cm">ចំការមន</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ឃុំ/សង្កាត់ <span class="required">*</span></label>
                                    <select>
                                        <option value="">ជ្រើសរើស</option>
                                        <option value="k1">ឃុំ១</option>
                                        <option value="k2">ឃុំ២</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row-3">
                                <div class="form-group">
                                    <label>ភូមិ <span class="required">*</span></label>
                                    <select>
                                        <option value="">ជ្រើសរើស</option>
                                        <option value="v1">ភូមិ១</option>
                                        <option value="v2">ភូមិ២</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ផ្លូវ</label>
                                    <input type="text">
                                </div>
                                <div class="form-group">
                                    <label>ផ្ទះលេខ/អាគារ</label>
                                    <input type="text">
                                </div>
                            </div>
                            
                            <div class="form-row-3">
                                <div class="form-group">
                                    <label>លេខទូរសព្ទ <span class="required">*</span></label>
                                    <input type="text" placeholder="012 345 678">
                                </div>
                                <div class="form-group">
                                    <label>ទូរស័ព្ទលើតុ</label>
                                    <input type="text" placeholder="023 123 456">
                                </div>
                                <div class="form-group">
                                    <label>អ៊ីម៉ែល <span class="required">*</span></label>
                                    <input type="text" placeholder="example@email.com">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2 -->
            <div class="section" id="sectionRepresentative">
                <div class="section-header" onclick="toggleSection(this)">
                    ២. អ្នកតំណាងស្នើសុំអាជ្ញាបណ្ណ
                </div>
                <div class="section-content">
                    <div class="form-container">
                    
                        <div class="radio-group">
                            <div class="radio-pill">
                                <input type="radio" id="rep_individual" name="representative_type" value="individual" checked onchange="toggleRepresentativeType()">
                                <label for="rep_individual">អ្នកតំណាងជារូបវន្តបុគ្គល</label>
                            </div>
                            <div class="radio-pill">
                                <input type="radio" id="rep_company" name="representative_type" value="company" onchange="toggleRepresentativeType()">
                                <label for="rep_company">អ្នកតំណាងជានីតិបុគ្គល</label>
                            </div>
                        </div>

                        <!-- Individual Representative Form -->
                        <div id="repIndividualForm" class="form-grid">
                            <div class="form-group full-width">
                                <div class="transfer-upload-row">
                                    <div class="transfer-label-text">
                                        <span>ឯកសារផ្ទេរសិទ្ទិ <span class="required">*</span></span>
                                        <a href="#">ឯកសារគំរូ</a>
                                    </div>
                                    <div>
                                        <input
                                            type="file"
                                            id="transferDoc1"
                                            class="transfer-file-input"
                                            accept=".pdf,.doc,.docx"
                                        >
                                        <button
                                            type="button"
                                            class="transfer-upload-btn"
                                            onclick="document.getElementById('transferDoc1').click()"
                                        >
                                            បញ្ចូល
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Company Representative Form -->
                        <div id="repCompanyForm" class="form-grid hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>ឈ្មោះក្រុមហ៊ុនអ្នកតំណាងចុះបញ្ជី(ភាសាខ្មែរ) <span class="required">*</span></label>
                                    <input type="text">
                                </div>
                                <div class="form-group">
                                    <label>ឈ្មោះក្រុមហ៊ុនអ្នកតំណាងចុះបញ្ជី(ឡាតាំង) <span class="required">*</span></label>
                                    <input type="text">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>លេខចុះបញ្ជីអាជីវកម្ម <span class="required">*</span> </label>
                                    <input type="text">
                                </div>
                                <div class="form-group">
                                    <label>លេខអាករលើតម្លៃបន្ថែម(អតប) <span class="required">*</span></label>
                                    <input type="text">
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                <div class="transfer-upload-row">
                                    <div class="transfer-label-text">
                                        <span>ឯកសារផ្ទេរសិទ្ទិ <span class="required">*</span></span>
                                        <a href="#">ឯកសារគំរូ</a>
                                    </div>
                                    <div>
                                        <input
                                            type="file"
                                            id="transferDoc2"
                                            class="transfer-file-input"
                                            accept=".pdf,.doc,.docx"
                                        >
                                        <button
                                            type="button"
                                            class="transfer-upload-btn"
                                            onclick="document.getElementById('transferDoc2').click()"
                                        >
                                            បញ្ចូល
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 1 navigation -->
            <div class="step-nav">

                <!-- Left Button -->
                <button class="btn btn-outline-green">
                    <span class="btn-icon">
                        <!-- Save icon -->
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M5 3h14v18H5z" fill="none" stroke="currentColor" stroke-width="1.6"/>
                            <path d="M5 9h14" stroke="currentColor" stroke-width="1.6"/>
                            <path d="M9 3v6" stroke="currentColor" stroke-width="1.6"/>
                            <rect x="9" y="13" width="6" height="5" stroke="currentColor" stroke-width="1.6" fill="none"/>
                        </svg>
                    </span>
                    រក្សាទុក & ចាកចេញ
                </button>

                <!-- Right Button -->
                <button class="btn btn-primary"  onclick="goToStep(2)">
                    បន្ទាប់
                    <span class="btn-icon-right">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" fill="none" />
                        </svg>
                    </span>
                </button>
            </div>
        </div>

        <!-- STEP 2 CONTENT: Section 1 + Section 2 -->
        <div class="step-content" id="step-2">

            <!-- Section 1: គោលបំណងនិងលក្ខណៈនៃសំណើ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    ១. គោលបំណងនិងលក្ខណៈនៃសំណើ
                </div>
                <div class="section-content">
                    <div class="form-container">
                        <div class="checkbox-list">
                            <label class="checkbox-item">
                                <input type="checkbox" id="purpose_register">
                                <span>ការចុះបញ្ជី</span>
                            </label>

                            <label class="checkbox-item">
                                <input type="checkbox" id="purpose_analysis">
                                <span>ការធ្វើវិភាគ</span>
                            </label>

                            <label class="checkbox-item">
                                <input type="checkbox" id="purpose_bio">
                                <span>ការសាកល្បងជីវប្រសិទ្ធភាព</span>
                            </label>

                            <label class="checkbox-item">
                                <input type="checkbox" id="purpose_commercial">
                                <span>សម្រាប់គោលបំណងពាណិជ្ជកម្ម</span>
                            </label>

                            <label class="checkbox-item">
                                <input type="checkbox" id="purpose_noncommercial">
                                <span>សម្រាប់គោលបំណងមិនមែនពាណិជ្ជកម្ម</span>
                            </label>

                            <label class="checkbox-item">
                                <input type="checkbox" id="purpose_new">
                                <span>ការចុះបញ្ជីថ្មី</span>
                            </label>

                            <label class="checkbox-item">
                                <input type="checkbox" id="purpose_renew">
                                <span>បន្តការចុះបញ្ជីជាថ្មី</span>
                            </label>

                            <label class="checkbox-item">
                                <input type="checkbox" id="purpose_other" onclick="toggleOtherPurposeInput()">
                                <span>ផ្សេងៗ</span>
                            </label>
                        </div>

                        <input
                            type="text"
                            id="otherPurposeText"
                            placeholder="សូមបញ្ជាក់គោលបំណងផ្សេងៗ..."
                        />
                    </div>
                </div>
            </div>

            <!-- Section 2: យថាប្រភេទជីកសិកម្មដែលស្នើសុំ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    ២. យថាប្រភេទជីកសិកម្មដែលស្នើសុំ
                </div>
                <div class="section-content" style="max-height:none;">
                    <div class="form-container">
                        <div class="table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ល.រ</th>
                                        <th>យថាប្រភេទ</th>
                                        <th>ចំណាត់ថ្នាក់ប្រភេទជី</th>
                                        <th>ឈ្មោះពាណិជ្ជកម្ម</th>
                                        <th>ប្រទេសដើមផលិត</th>
                                        <th>ប្រទេសវេចខ្ចប់/នាំចេញ</th>
                                        <th>សកម្មភាព</th>
                                    </tr>
                                </thead>
                                <tbody id="fertilizerTableBody">
                                    <tr>
                                        <td>1</td>
                                        <td><input type="text"></td>
                                        <td><input type="text"></td>
                                        <td><input type="text"></td>
                                        <td><input type="text"></td>
                                        <td><input type="text"></td>
                                        <td>
                                            <button type="button" class="btn-outline-green" onclick="removeFertilizerRow(this)">
                                                លុប
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="table-actions">
                            <button type="button" class="btn-outline-green" onclick="addFertilizerRow()">
                                បន្ថែមជួរឈរ
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2 navigation -->
            <div class="step-nav">
                <!-- Left -->
                <button class="btn btn-outline-green">
                    <span class="btn-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M5 3h14v18H5z" fill="none" stroke="currentColor" stroke-width="1.6"/>
                            <path d="M5 9h14" stroke="currentColor" stroke-width="1.6"/>
                            <path d="M9 3v6" stroke="currentColor" stroke-width="1.6"/>
                            <rect x="9" y="13" width="6" height="5" stroke="currentColor" stroke-width="1.6" fill="none"/>
                        </svg>
                    </span>
                    រក្សាទុក & ចាកចេញ
                </button>

                <!-- Right buttons -->
                <div class="step-right-group">
                    <button class="btn btn-outline-green" onclick="goToStep(1)">
                        <span class="btn-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </span>
                        ត្រឡប់ក្រោយ
                    </button>

                    <button class="btn btn-primary" onclick="goToStep(3)">
                        បន្ទាប់
                        <span class="btn-icon-right">
                            <svg viewBox="0 0 24 24">
                                <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- STEP 3 CONTENT -->
        <div class="step-content" id="step-3">
            <div class="section">
                <div class="section-header">
                    ៣. ឯកសារភ្ជាប់
                </div>
                <div class="section-content" style="max-height:none;">
                    <div class="form-container">
                        <p style="font-size:14px; color:#555;">(មាតិកាឯកសារភ្ជាប់ នឹងបញ្ចូលនៅពេលក្រោយ)</p>
                    </div>
                </div>
            </div>
            <div class="step-nav">
                <!-- Left -->
                <button class="btn btn-outline-green">
                    <span class="btn-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M5 3h14v18H5z" stroke="currentColor" stroke-width="1.6" fill="none"/>
                            <path d="M5 9h14" stroke="currentColor" stroke-width="1.6"/>
                            <path d="M9 3v6" stroke="currentColor" stroke-width="1.6"/>
                            <rect x="9" y="13" width="6" height="5" stroke="currentColor" stroke-width="1.6" fill="none"/>
                        </svg>
                    </span>
                    រក្សាទុក & ចាកចេញ
                </button>

                <!-- Right -->
                <div class="step-right-group">
                    <button class="btn btn-outline-green" onclick="goToStep(2)">
                        <span class="btn-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </span>
                        ត្រឡប់ក្រោយ
                    </button>

                    <button class="btn btn-primary" onclick="goToStep(4)">
                        បន្ទាប់
                        <span class="btn-icon-right">
                            <svg viewBox="0 0 24 24">
                                <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- STEP 4 CONTENT -->
        <div class="step-content" id="step-4">
            <div class="section">
                <div class="section-header">
                    ៤. ពិនិត្យឡើងវិញ
                </div>
                <div class="section-content" style="max-height:none;">
                    <div class="form-container">
                        <p style="font-size:14px; color:#555;">(ទំព័រពិនិត្យឡើងវិញ នឹងបង្ហាញសេចក្តីសង្ខេប ពាក្យស្នើសំុទាំងមូល)</p>
                    </div>
                </div>
            </div>
            <div class="step-nav">
                <!-- Left -->
                <button class="btn btn-outline-green">
                    <span class="btn-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M5 3h14v18H5z" stroke="currentColor" stroke-width="1.6" fill="none"/>
                            <path d="M5 9h14" stroke="currentColor" stroke-width="1.6"/>
                            <path d="M9 3v6" stroke="currentColor" stroke-width="1.6"/>
                            <rect x="9" y="13" width="6" height="5" stroke="currentColor" stroke-width="1.6" fill="none"/>
                        </svg>
                    </span>
                    រក្សាទុក & ចាកចេញ
                </button>

                <!-- Right -->
                <div class="step-right-group">
                    <button class="btn btn-outline-green" onclick="goToStep(3)">
                        <span class="btn-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </span>
                        ត្រឡប់ក្រោយ
                    </button>

                    <button class="btn btn-primary" onclick="goToStep(5)">
                        បន្ទាប់
                        <span class="btn-icon-right">
                            <svg viewBox="0 0 24 24">
                                <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- STEP 5 CONTENT -->
        <div class="step-content" id="step-5">
            <div class="section">
                <div class="section-header">
                    ១. បង់ប្រាក់
                </div>
                <div class="section-content" style="max-height:none;">
                    <div class="form-container">
                        <p style="font-size:14px; color:#555;">(ទំព័របង់ប្រាក់ នឹងបញ្ចូលការជ្រើសរើសវិធីបង់ប្រាក់នៅពេលក្រោយ)</p>
                    </div>
                </div>
            </div>
            <div class="step-nav">
                <!-- Left -->
                <button class="btn btn-outline-green">
                    <span class="btn-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M5 3h14v18H5z" stroke="currentColor" stroke-width="1.6" fill="none"/>
                            <path d="M5 9h14" stroke="currentColor" stroke-width="1.6"/>
                            <path d="M9 3v6" stroke="currentColor" stroke-width="1.6"/>
                            <rect x="9" y="13" width="6" height="5" stroke="currentColor" stroke-width="1.6" fill="none"/>
                        </svg>
                    </span>
                    រក្សាទុក & ចាកចេញ
                </button>

                <!-- Right -->
                <div class="step-right-group">
                    <button class="btn btn-outline-green" onclick="goToStep(4)">
                        <span class="btn-icon">
                            <svg viewBox="0 0 24 24">
                                <path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </span>
                        ត្រឡប់ក្រោយ
                    </button>

                    <button class="btn btn-primary" onclick="submitForm()">
                        ដាក់ស្នើ
                        <span class="btn-icon-right">
                            <svg viewBox="0 0 24 24">
                                <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;

        function goToStep(step) {
            currentStep = step;

            // update step content
            document.querySelectorAll('.step-content').forEach(el => {
                el.classList.remove('active');
            });
            const target = document.getElementById('step-' + step);
            if (target) target.classList.add('active');

            // update stepper UI (active, completed)
            document.querySelectorAll('.step-item').forEach(item => {
                const s = parseInt(item.getAttribute('data-step'), 10);
                item.classList.remove('active', 'completed');
                if (s < step) {
                    item.classList.add('completed');
                } else if (s === step) {
                    item.classList.add('active');
                }
            });
        }

        function toggleSection(header) {
            const content = header.nextElementSibling;
            header.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        }

        function toggleFormType() {
            const companyForm = document.getElementById('companyForm');
            const individualForm = document.getElementById('individualForm');
            const isCompany = document.getElementById('company').checked;
            const selfWrapper = document.getElementById('selfApplicantWrapper');
            const selfCheckbox = document.getElementById('selfApplicant');

            if (isCompany) {
                companyForm.classList.remove('hidden');
                individualForm.classList.add('hidden');
                if (selfWrapper) selfWrapper.style.display = 'none';
                if (selfCheckbox) selfCheckbox.checked = false;
            } else {
                companyForm.classList.add('hidden');
                individualForm.classList.remove('hidden');
                if (selfWrapper) selfWrapper.style.display = 'flex';
            }

            handleSelfApplicantToggle();
        }

        function toggleCamdxCompany() {
            const camdxCompanyField = document.getElementById('camdxCompanyField');
            const isCamdxYes = document.getElementById('camdx_yes').checked;
            
            if (isCamdxYes) {
                camdxCompanyField.classList.remove('hidden');
            } else {
                camdxCompanyField.classList.add('hidden');
            }
        }

        function toggleRepresentativeType() {
            const repIndividualForm = document.getElementById('repIndividualForm');
            const repCompanyForm = document.getElementById('repCompanyForm');
            const isIndividual = document.getElementById('rep_individual').checked;
            
            if (isIndividual) {
                repIndividualForm.classList.remove('hidden');
                repCompanyForm.classList.add('hidden');
            } else {
                repIndividualForm.classList.add('hidden');
                repCompanyForm.classList.remove('hidden');
            }
        }

        function previewPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.querySelector('.file-upload-preview');
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // control Section 2 visibility based on radio + checkbox
        function handleSelfApplicantToggle() {
            const sectionRep = document.getElementById('sectionRepresentative');
            const isIndividual = document.getElementById('individual').checked;
            const selfCheckbox = document.getElementById('selfApplicant');

            if (!sectionRep) return;

            if (isIndividual && selfCheckbox && selfCheckbox.checked) {
                sectionRep.classList.add('hidden');
            } else {
                sectionRep.classList.remove('hidden');
            }
        }

        // NEW: toggle "Other" purpose text input
        function toggleOtherPurposeInput() {
            const cb = document.getElementById('purpose_other');
            const input = document.getElementById('otherPurposeText');
            if (!cb || !input) return;
            input.style.display = cb.checked ? 'block' : 'none';
        }

        // NEW: add/remove fertilizer rows
        function addFertilizerRow() {
            const tbody = document.getElementById('fertilizerTableBody');
            if (!tbody) return;
            const index = tbody.rows.length + 1;
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${index}</td>
                <td><input type="text"></td>
                <td><input type="text"></td>
                <td><input type="text"></td>
                <td><input type="text"></td>
                <td><input type="text"></td>
                <td>
                    <button type="button" class="btn-outline-green" onclick="removeFertilizerRow(this)">
                        លុប
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
        }

        function removeFertilizerRow(btn) {
            const row = btn.closest('tr');
            const tbody = document.getElementById('fertilizerTableBody');
            if (!row || !tbody) return;
            tbody.removeChild(row);
            // re-index
            Array.from(tbody.rows).forEach((r, i) => {
                r.cells[0].textContent = i + 1;
            });
        }

        // initial state
        window.addEventListener('DOMContentLoaded', () => {
            toggleFormType();
            handleSelfApplicantToggle();
            toggleRepresentativeType();
            goToStep(1);
        });

        function submitForm() {
            alert('Submit clicked (demo)');
        }
    </script>
</body>
</html>
